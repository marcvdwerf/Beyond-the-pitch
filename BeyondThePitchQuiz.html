<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beyond The Pitch - Find Your Next Adventure</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      -webkit-font-smoothing: antialiased; 
      -moz-osx-font-smoothing: grayscale; 
    }
    
    /* Card Selection States */
    .card-selected { 
      border-color: #e85d35;
      background: linear-gradient(135deg, #FFF7F1 0%, #FFE8DC 100%);
      box-shadow: 0 8px 24px rgba(232, 93, 53, 0.15);
      transform: scale(1.02);
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }
    
    /* Animations */
    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    .slide-in {
      animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    /* Celebration Effect */
    @keyframes celebrate {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .celebrate {
      animation: celebrate 0.6s ease-in-out;
    }
    
    /* Progress Bar */
    .progress-bar-animate {
      transition: width 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    /* Milestone Badge */
    .milestone-badge {
      animation: badgePop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes badgePop {
      0% { 
        transform: scale(0) rotate(-180deg);
        opacity: 0;
      }
      100% { 
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }
    
    /* Button States */
    .btn-primary {
      background: linear-gradient(135deg, #e85d35 0%, #d14d25 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover:not(.btn-disabled) {
      background: linear-gradient(135deg, #d14d25 0%, #b83d15 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(232, 93, 53, 0.3);
    }
    
    .btn-disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Destination Cards with Image Placeholders */
    .destination-card {
      position: relative;
      overflow: hidden;
      border-radius: 1rem;
      transition: all 0.3s ease;
    }
    
    .destination-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      opacity: 0.1;
      z-index: 0;
    }
    
    .destination-card.ireland::before {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .destination-card.lima::before {
      background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
    }
    
    .destination-card.mongolia::before {
      background: linear-gradient(135deg, #0575e6 0%, #021b79 100%);
    }
    
    .destination-image-placeholder {
      height: 200px;
      background-size: cover;
      background-position: center;
      border-radius: 0.75rem;
      position: relative;
      overflow: hidden;
    }
    
    /* Add your images here - replace URL with your own */
    .destination-image-placeholder.ireland {
      background-image: url('https://images.unsplash.com/photo-1590086782792-42dd2350140d?w=800');
    }
    
    .destination-image-placeholder.lima {
      background-image: url('https://images.unsplash.com/photo-1531968455001-5c5272a41129?w=800');
    }
    
    .destination-image-placeholder.mongolia {
      background-image: url('https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=800');
    }
    
    /* Multi-select with images */
    .interest-card {
      position: relative;
      min-height: 100px;
      background-size: cover;
      background-position: center;
    }
    
    .interest-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.6) 100%);
      border-radius: 0.75rem;
      pointer-events: none;
    }
    
    /* Checkmark for selected items */
    .checkmark {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: #e85d35;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      z-index: 10;
      opacity: 0;
      transform: scale(0);
      transition: all 0.3s ease;
    }
    
    .card-selected .checkmark {
      opacity: 1;
      transform: scale(1);
    }
    
    /* Match Score */
    .match-score {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 4rem;
      font-weight: 900;
      line-height: 1;
    }
    
    /* Testimonial styling */
    .testimonial-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-left: 4px solid #e85d35;
    }
    
    /* Loading spinner */
    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #e85d35;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Touch feedback */
    @media (hover: none) {
      .card-hover:active {
        transform: scale(0.98);
      }
    }
    
    /* Hero background animation */
    .hero-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      background-size: 200% 200%;
      animation: gradientShift 15s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
  </style>
</head>
<body class="bg-[#1a1a2e] text-white min-h-screen">

<header class="max-w-4xl mx-auto px-4 py-4">
  <a href="https://travelbeyondthepitch.com" class="inline-flex items-center gap-3">
    <img 
      src="https://raw.githubusercontent.com/marcvdwerf/Beyond-the-pitch/refs/heads/main/images/beyond%20the%20pitch%20logo.jpg" 
      alt="Travel Beyond The Pitch"
      class="h-8 w-auto"
    />
  </a>
</header>

<!-- Celebration Toast -->
<div id="celebration-toast" class="fixed top-20 left-1/2 -translate-x-1/2 bg-white text-gray-900 px-6 py-3 rounded-full shadow-2xl z-50 hidden items-center gap-3">
  <span class="text-2xl" id="celebration-emoji">ðŸŽ‰</span>
  <span class="font-semibold" id="celebration-text"></span>
</div>

<div id="quiz-root" class="min-h-screen"></div>

<script>
(function () {
  const STORAGE_KEY = 'btp_quiz_state';
  
  // TODO: Replace with your actual Google Form URL and field IDs
  const GOOGLE_FORM_URL = 'https://docs.google.com/forms/u/0/d/e/YOUR_FORM_ID/formResponse';
  
  const FORM_FIELDS = {
    email: 'entry.123456789',
    age: 'entry.987654321',
    location: 'entry.456789123',
    pilot: 'entry.111222333',
    interests: 'entry.444555666',
    sport: 'entry.777888999',
    travelStyle: 'entry.101112131',
    group: 'entry.141516171',
    timing: 'entry.181920212',
    future: 'entry.232425262'
  };

  const root = document.getElementById('quiz-root');

  const steps = [
    {
      id: 'intro',
      type: 'intro',
      title: 'Discover Your Perfect Sport & Culture Journey',
      subtitle: 'Travel beyond the stadium. Dive into communities, traditions and untold stories.',
      description: 'Experience sport the way locals doâ€”from ancient Gaelic games in Irish villages to the electric passion of Lima\'s football culture.',
      stat: 'Co-created with local clubs, fans and communities'
    },
    {
      id: 'pilot',
      type: 'destinations',
      title: 'Which destination speaks to you?',
      subtitle: 'Choose your adventure',
      options: [
        {
          value: 'ireland',
          country: 'Ireland',
          title: 'Gaelic Games',
          flag: 'ðŸ‡®ðŸ‡ª',
          description: 'Ancient Irish sports, traditional pub culture, and rolling countryside',
          vibe: ['Authentic', 'Cultural', 'Community'],
          highlight: 'Experience hurling & Gaelic football with locals',
          price: 'From â‚¬595'
        },
        {
          value: 'lima',
          country: 'Peru',
          title: 'Alianza Lima',
          flag: 'ðŸ‡µðŸ‡ª',
          description: 'South American football passion, world-class cuisine, and Pacific vibes',
          vibe: ['Vibrant', 'Passionate', 'Culinary'],
          highlight: 'Feel the intensity of Lima football culture',
          price: 'From â‚¬745'
        },
        {
          value: 'mongolia',
          country: 'Mongolia',
          title: 'Naadam Festival',
          flag: 'ðŸ‡²ðŸ‡³',
          description: 'Wrestling, archery, horse racing in vast steppes with nomadic traditions',
          vibe: ['Epic', 'Adventurous', 'Unique'],
          highlight: 'Witness centuries-old warrior sports',
          price: 'From â‚¬1,295'
        }
      ]
    },
    {
      id: 'interests',
      type: 'multi-select',
      title: 'What makes travel meaningful to you?',
      subtitle: 'Select all that resonate',
      minSelections: 2,
      options: [
        { value: 'sport', label: 'Live Sport', icon: 'âš½', popular: true },
        { value: 'food', label: 'Local Cuisine', icon: 'ðŸœ', popular: true },
        { value: 'culture', label: 'Deep Culture', icon: 'ðŸ›ï¸' },
        { value: 'nightlife', label: 'Nightlife', icon: 'ðŸŒ™' },
        { value: 'locals', label: 'Meet Locals', icon: 'ðŸ¤', popular: true },
        { value: 'language', label: 'Language', icon: 'ðŸ’¬' },
        { value: 'nature', label: 'Nature', icon: 'ðŸ”ï¸' },
        { value: 'photography', label: 'Photography', icon: 'ðŸ“¸' }
      ]
    },
    {
      id: 'sport',
      type: 'single-select',
      title: 'Your sport preference?',
      subtitle: 'Choose what excites you most',
      options: [
        { value: 'football-major', label: 'Football (Major Leagues)', desc: 'Top-tier clubs & stadiums', icon: 'âš½' },
        { value: 'football-local', label: 'Football (Local Culture)', desc: 'Community clubs & authenticity', icon: 'ðŸŸï¸' },
        { value: 'traditional', label: 'Traditional Sports', desc: 'Indigenous & cultural sports', icon: 'ðŸŽ¯' },
        { value: 'basketball', label: 'Basketball', desc: 'NBA, EuroLeague, street culture', icon: 'ðŸ€' },
        { value: 'rugby', label: 'Rugby', desc: 'Six Nations, local clubs', icon: 'ðŸ‰' },
        { value: 'combat', label: 'Combat Sports', desc: 'Boxing, MMA, martial arts', icon: 'ðŸ¥Š' },
        { value: 'open', label: 'Open to Anything', desc: 'Surprise me with unique experiences', icon: 'âœ¨' }
      ]
    },
    {
      id: 'group',
      type: 'single-select',
      title: 'Who are you traveling with?',
      subtitle: 'Help us personalize your experience',
      options: [
        { value: 'solo', label: 'Solo Traveler', desc: 'Flying solo, open to meeting others', icon: 'ðŸŽ’' },
        { value: 'couple', label: 'With Partner', desc: 'Traveling as a couple', icon: 'â¤ï¸' },
        { value: 'friends', label: 'Friends Group', desc: '2-6 friends', icon: 'ðŸ‘¥' },
        { value: 'family', label: 'Family', desc: 'Family adventure', icon: 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§' },
        { value: 'corporate', label: 'Corporate/Team', desc: 'Team building or corporate trip', icon: 'ðŸ’¼' }
      ]
    },
    {
      id: 'timing',
      type: 'quick-select',
      title: 'When are you looking to travel?',
      subtitle: 'This helps us show you available dates',
      options: [
        { value: 'next-3', label: 'Next 3 months', icon: 'ðŸ—“ï¸' },
        { value: 'next-6', label: 'Next 6 months', icon: 'ðŸ“…' },
        { value: 'this-year', label: 'This year', icon: 'ðŸŒŸ' },
        { value: 'exploring', label: 'Just exploring', icon: 'ðŸ”' }
      ]
    },
    {
      id: 'travelStyle',
      type: 'cards',
      title: 'Choose your experience level',
      subtitle: 'How do you like to travel?',
      options: [
        { 
          value: 'immersive', 
          label: 'Immersive Explorer', 
          icon: 'ðŸŽ’', 
          desc: 'Deep local experiences, authentic connections, shared accommodations',
          features: ['Local homestays', 'Group experiences', 'Public transport', 'Authentic dining'],
          investment: 'â‚¬400-700'
        },
        { 
          value: 'balanced', 
          label: 'Balanced Adventurer', 
          icon: 'ðŸ§³', 
          desc: 'Mix of comfort and local culture, curated experiences',
          features: ['3-star hotels', 'Mix of group & private', 'Local guides', 'Curated dining'],
          investment: 'â‚¬700-1,200',
          popular: true
        },
        { 
          value: 'premium', 
          label: 'Premium Traveler', 
          icon: 'âœ¨', 
          desc: 'Comfort-first with exclusive access and personalized touches',
          features: ['4-star hotels', 'Private experiences', 'Dedicated guide', 'Fine dining'],
          investment: 'â‚¬1,200+'
        }
      ]
    },
    {
      id: 'future',
      type: 'multi-select',
      title: 'What would you love to see next?',
      subtitle: 'Help shape our future journeys',
      minSelections: 1,
      options: [
        { value: 'derbies', label: 'Football Derbies', icon: 'âš”ï¸' },
        { value: 'basketball', label: 'Basketball Culture', icon: 'ðŸ€' },
        { value: 'rugby', label: 'Rugby Experiences', icon: 'ðŸ‰' },
        { value: 'balkans', label: 'Balkans', icon: 'ðŸ‡·ðŸ‡¸' },
        { value: 'latam', label: 'Latin America', icon: 'ðŸŒŽ' },
        { value: 'africa', label: 'Africa', icon: 'ðŸŒ' },
        { value: 'asia', label: 'Central Asia', icon: 'ðŸ”ï¸' },
        { value: 'traditional', label: 'Indigenous Sports', icon: 'ðŸŽª' }
      ]
    },
    {
      id: 'contact',
      type: 'email',
      title: 'Get Your Personalized Match',
      subtitle: 'Receive your journey + exclusive early access',
      fields: [
        { id: 'email', label: 'Email Address', type: 'email', required: true, placeholder: 'you@example.com' },
        { id: 'age', label: 'Age Range', type: 'select', required: true, options: ['18-24', '25-34', '35-44', '45-54', '55+'] },
        { id: 'location', label: 'Where are you from?', type: 'text', required: false, placeholder: 'City, Country' }
      ]
    }
  ];

  const recommendations = {
    ireland: {
      title: 'Ireland - Gaelic Games Experience',
      flag: 'ðŸ‡®ðŸ‡ª',
      tagline: 'Where Ancient Sport Meets Warm Hospitality',
      description: 'Based on your preferences, Ireland offers the perfect blend of authentic sport culture, community connection, and immersive local experiences.',
      matchScore: 95,
      highlights: [
        'Experience hurling and Gaelic football with local clubs',
        'Traditional pub sessions with players and locals',
        'Explore Irish countryside and coastal beauty',
        'Learn basic Irish phrases and sport terminology'
      ],
      whatsIncluded: ['Match tickets', 'Local guide', 'Traditional meals', 'Pub experiences', 'Cultural workshops'],
      testimonial: 'An unforgettable experience. The locals welcomed us like family. - Marc, Netherlands'
    },
    lima: {
      title: 'Lima - Alianza Lima Football',
      flag: 'ðŸ‡µðŸ‡ª',
      tagline: 'Where Football Passion Fuels a City',
      description: 'Your answers point to Lima - a destination where intense football culture meets world-renowned cuisine and vibrant nightlife.',
      matchScore: 92,
      highlights: [
        "Feel the electricity of South American football",
        "Culinary tour through Lima's food scene",
        "Experience Peruvian nightlife with locals",
        "Visit historic neighborhoods and markets"
      ],
      whatsIncluded: ['Stadium experience', 'Food tours', 'Local host', 'City exploration', 'Nightlife access'],
      testimonial: 'The passion at the stadium gave me goosebumps every time. Lima exceeded all expectations. - JosÃ©, Lima'
    },
    mongolia: {
      title: 'Mongolia - Naadam Festival',
      flag: 'ðŸ‡²ðŸ‡³',
      tagline: 'An Epic Journey Into Warrior Traditions',
      description: "You're drawn to the extraordinary. Mongolia's Naadam Festival offers an adventure unlike anything else - ancient sports in vast landscapes.",
      matchScore: 89,
      highlights: [
        'Witness traditional wrestling, archery, and horse racing',
        'Stay with nomadic families in the steppe',
        'Experience centuries-old warrior culture',
        'Explore Ulaanbaatar and endless grasslands'
      ],
      whatsIncluded: ['Festival access', 'Nomadic homestay', 'Cultural guide', 'Traditional meals', 'Nature experiences'],
      testimonial: 'Life-changing. The festival and landscapes are beyond words. - Thomas, Germany'
    }
  };

  // Milestones for celebration
  const milestones = {
    1: { emoji: 'ðŸŽ¯', text: 'Great start!' },
    3: { emoji: 'ðŸ”¥', text: 'You\'re on fire!' },
    5: { emoji: 'ðŸ’ª', text: 'Halfway there!' },
    7: { emoji: 'ðŸŒŸ', text: 'Almost done!' },
    9: { emoji: 'ðŸ†', text: 'Final question!' }
  };

  let currentStep = 0;
  const answers = {};
  let isSubmitting = false;
  let showResult = false;
  let submitError = null;
  let touchStartX = 0;
  let touchStartY = 0;

  // State management
  function loadState() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        const state = JSON.parse(saved);
        Object.assign(answers, state.answers || {});
        currentStep = state.currentStep || 0;
      }
    } catch (e) {
      console.error('Failed to load state:', e);
    }
  }

  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        answers,
        currentStep,
        timestamp: Date.now()
      }));
    } catch (e) {
      console.error('Failed to save state:', e);
    }
  }

  function clearState() {
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {
      console.error('Failed to clear state:', e);
    }
  }

  // Celebration toast
  function showCelebration(emoji, text) {
    const toast = document.getElementById('celebration-toast');
    const emojiEl = document.getElementById('celebration-emoji');
    const textEl = document.getElementById('celebration-text');
    
    emojiEl.textContent = emoji;
    textEl.textContent = text;
    
    toast.classList.remove('hidden');
    toast.classList.add('flex', 'milestone-badge');
    
    setTimeout(() => {
      toast.classList.add('hidden');
      toast.classList.remove('flex', 'milestone-badge');
    }, 2500);
  }

  // Progress calculation
  function progressPercent() {
    const totalSteps = steps.length - 2; // Exclude intro and contact
    const current = Math.max(0, currentStep - 1);
    return Math.round((current / totalSteps) * 100);
  }

  function canProceedForStep(step) {
    if (!step) return false;
    if (step.type === 'intro') return true;
    if (step.type === 'email') {
      return answers.email && isValidEmail(answers.email) && answers.age;
    }
    if (step.type === 'multi-select') {
      const minSelections = step.minSelections || 1;
      return Array.isArray(answers[step.id]) && answers[step.id].length >= minSelections;
    }
    return answers[step.id] !== undefined && answers[step.id] !== null && answers[step.id] !== '';
  }

  function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function esc(s) { 
    return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); 
  }

  // Google Forms submission
  async function submitToGoogleForms() {
    const formData = new FormData();
    
    Object.keys(FORM_FIELDS).forEach(key => {
      const value = answers[key];
      if (value !== undefined && value !== null) {
        if (Array.isArray(value)) {
          formData.append(FORM_FIELDS[key], value.join(', '));
        } else {
          formData.append(FORM_FIELDS[key], value);
        }
      }
    });

    try {
      await fetch(GOOGLE_FORM_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      });
      
      return { success: true };
    } catch (error) {
      console.error('Submission error:', error);
      return { success: false, error: error.message };
    }
  }

  // Navigation
  function goToStep(stepIndex) {
    if (stepIndex < 0 || stepIndex >= steps.length) return;
    
    // Show milestone celebration
    if (milestones[stepIndex]) {
      showCelebration(milestones[stepIndex].emoji, milestones[stepIndex].text);
    }
    
    currentStep = stepIndex;
    saveState();
    render();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function nextStep() {
    goToStep(currentStep + 1);
  }

  function prevStep() {
    goToStep(currentStep - 1);
  }

  // Touch/swipe handling for mobile
  function setupTouchHandlers(element) {
    element.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }, { passive: true });

    element.addEventListener('touchend', (e) => {
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      
      const diffX = touchStartX - touchEndX;
      const diffY = touchStartY - touchEndY;
      
      // Only trigger if horizontal swipe is dominant
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0 && canProceedForStep(steps[currentStep])) {
          nextStep(); // Swipe left
        } else if (diffX < 0 && currentStep > 1) {
          prevStep(); // Swipe right
        }
      }
    }, { passive: true });
  }

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (showResult) return;
    
    const step = steps[currentStep];
    if (!step || step.type === 'intro' || step.type === 'email') return;
    
    if (e.key === 'ArrowRight' && canProceedForStep(step)) {
      nextStep();
    } else if (e.key === 'ArrowLeft' && currentStep > 1) {
      prevStep();
    }
  });

  // Shell architecture
  let shellBuilt = false;
  let el = {};

  function buildShell() {
    root.innerHTML = `
      <div class="max-w-4xl mx-auto px-4 py-8 fade-in" id="btp-container">
        <div id="btp-progress" class="mb-6" style="display:none;">
          <div class="flex justify-between items-center mb-3">
            <span class="text-xs text-gray-400" id="btp-progress-text">Step 0 of 0</span>
            <span class="text-xs text-gray-400" id="btp-progress-percent">0%</span>
          </div>
          <div class="w-full bg-gray-700 rounded-full h-2 overflow-hidden">
            <div id="btp-progress-bar" class="bg-[#e85d35] h-2 rounded-full progress-bar-animate" style="width:0%"></div>
          </div>
        </div>

        <div id="btp-card" class="bg-white text-gray-900 rounded-2xl p-6 md:p-8 mb-6 shadow-xl">
          <div class="mb-6">
            <h2 class="text-2xl md:text-4xl font-bold mb-2 leading-tight" id="btp-title"></h2>
            <p class="text-sm md:text-base text-gray-600" id="btp-subtitle"></p>
          </div>

          <div id="step-content"></div>
        </div>

        <div id="step-controls" class="flex items-center justify-between gap-4"></div>
      </div>
    `;

    el.container = document.getElementById('btp-container');
    el.progress = document.getElementById('btp-progress');
    el.progressText = document.getElementById('btp-progress-text');
    el.progressPercent = document.getElementById('btp-progress-percent');
    el.progressBar = document.getElementById('btp-progress-bar');
    el.card = document.getElementById('btp-card');
    el.title = document.getElementById('btp-title');
    el.subtitle = document.getElementById('btp-subtitle');
    el.content = document.getElementById('step-content');
    el.controls = document.getElementById('step-controls');

    setupTouchHandlers(el.content);
    shellBuilt = true;
  }

  function render() {
    if (!shellBuilt) buildShell();

    if (showResult) {
      renderResult();
      return;
    }

    const step = steps[current
